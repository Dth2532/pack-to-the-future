<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pack To The Future</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Plan your outfits ahead of time - Your vacation wardrobe planner">
    <meta name="theme-color" content="#2C3E50">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Pack To The Future">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- App Icons -->
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2C3E50;
            --accent: #E8B298;
            --accent-dark: #C89976;
            --cream: #F8F6F3;
            --sand: #E8E3DC;
            --text: #2C3E50;
            --text-light: #7A8A99;
            --white: #FFFFFF;
        }

        body {
            font-family: 'Lato', sans-serif;
            background: var(--cream);
            color: var(--text);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        header {
            text-align: center;
            margin-bottom: 60px;
            padding: 60px 20px 40px;
            background: var(--white);
            border-bottom: 3px solid var(--primary);
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -10%;
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, var(--accent) 0%, transparent 70%);
            opacity: 0.15;
            animation: float 20s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            33% { transform: translate(30px, -30px) rotate(120deg); }
            66% { transform: translate(-20px, 20px) rotate(240deg); }
        }

        h1 {
            font-family: 'Playfair Display', serif;
            font-size: 3.5rem;
            font-weight: 900;
            letter-spacing: -2px;
            margin-bottom: 10px;
            color: var(--primary);
            position: relative;
        }

        .tagline {
            font-size: 1.1rem;
            color: var(--text-light);
            font-weight: 300;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 1.2fr;
            gap: 40px;
            margin-bottom: 60px;
        }

        .card {
            background: var(--white);
            border-radius: 4px;
            padding: 40px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
            border-top: 4px solid var(--accent);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
        }

        h2 {
            font-family: 'Playfair Display', serif;
            font-size: 2rem;
            margin-bottom: 25px;
            color: var(--primary);
            font-weight: 700;
            border-bottom: 2px solid var(--sand);
            padding-bottom: 15px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--primary);
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 1px;
        }

        input, textarea, select {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid var(--sand);
            border-radius: 2px;
            font-size: 1rem;
            font-family: 'Lato', sans-serif;
            background: var(--cream);
            color: var(--text);
            transition: all 0.3s ease;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--accent);
            background: var(--white);
            box-shadow: 0 0 0 3px rgba(232, 178, 152, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .button-group {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        button {
            padding: 14px 32px;
            border: none;
            border-radius: 2px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Lato', sans-serif;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }

        button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        button:hover::before {
            width: 300px;
            height: 300px;
        }

        button span {
            position: relative;
            z-index: 1;
        }

        .btn-primary {
            background: var(--primary);
            color: var(--white);
            flex: 1;
        }

        .btn-primary:hover {
            background: #1a2533;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(44, 62, 80, 0.3);
        }

        .btn-secondary {
            background: var(--accent);
            color: var(--white);
        }

        .btn-secondary:hover {
            background: var(--accent-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(232, 178, 152, 0.3);
        }

        .event-list {
            max-height: 600px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .event-list::-webkit-scrollbar {
            width: 8px;
        }

        .event-list::-webkit-scrollbar-track {
            background: var(--sand);
            border-radius: 4px;
        }

        .event-list::-webkit-scrollbar-thumb {
            background: var(--accent);
            border-radius: 4px;
        }

        .event-item {
            background: var(--cream);
            border-left: 4px solid var(--accent);
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 0 4px 4px 0;
            animation: slideIn 0.4s ease;
            transition: all 0.3s ease;
        }

        .event-item:hover {
            transform: translateX(4px);
            box-shadow: -4px 4px 12px rgba(0, 0, 0, 0.08);
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .event-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 12px;
        }

        .event-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--primary);
        }

        .event-date {
            font-size: 0.9rem;
            color: var(--text-light);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .event-outfit {
            color: var(--text);
            line-height: 1.8;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid var(--sand);
        }

        .delete-btn {
            background: transparent;
            color: var(--text-light);
            padding: 8px 16px;
            font-size: 0.85rem;
            margin-top: 12px;
            border: 1px solid var(--sand);
        }

        .delete-btn:hover {
            background: #E74C3C;
            color: var(--white);
            border-color: #E74C3C;
        }

        .packing-section {
            background: var(--white);
            border-radius: 4px;
            padding: 40px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
            border-top: 4px solid var(--primary);
        }

        .category-filters {
            display: flex;
            gap: 12px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 10px 20px;
            background: var(--sand);
            color: var(--text);
            border: 2px solid var(--sand);
            border-radius: 4px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .filter-btn:hover {
            background: var(--cream);
            border-color: var(--accent);
        }

        .filter-btn.active {
            background: var(--accent);
            color: var(--white);
            border-color: var(--accent-dark);
        }

        .category-section {
            margin-bottom: 40px;
        }

        .category-header {
            font-family: 'Playfair Display', serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--sand);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .category-count {
            font-size: 1rem;
            color: var(--text-light);
            font-weight: 400;
            font-family: 'Lato', sans-serif;
        }

        .packing-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 16px;
        }

        .packing-item {
            background: var(--cream);
            padding: 16px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .packing-item:hover {
            border-color: var(--accent);
            transform: scale(1.02);
        }

        .packing-item.packed {
            background: var(--accent);
            color: var(--white);
            border-color: var(--accent-dark);
        }

        .checkbox {
            width: 24px;
            height: 24px;
            border: 3px solid var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: all 0.3s ease;
        }

        .packing-item.packed .checkbox {
            background: var(--white);
            border-color: var(--white);
        }

        .checkbox::after {
            content: '‚úì';
            font-weight: 900;
            font-size: 1.2rem;
            opacity: 0;
            transform: scale(0);
            transition: all 0.3s ease;
            color: var(--accent);
        }

        .packing-item.packed .checkbox::after {
            opacity: 1;
            transform: scale(1);
        }

        .packing-item-name {
            font-weight: 600;
            font-size: 0.95rem;
        }

        .assign-btn {
            background: transparent;
            color: var(--accent);
            padding: 4px 8px;
            font-size: 0.75rem;
            margin-left: auto;
            border: 1px solid var(--accent);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .assign-btn:hover {
            background: var(--accent);
            color: var(--white);
        }

        .assigned-items {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--sand);
        }

        .assigned-items-header {
            font-weight: 700;
            color: var(--primary);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
        }

        .assigned-item-tag {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: var(--accent);
            color: var(--white);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            margin: 4px 4px 4px 0;
            animation: slideIn 0.3s ease;
        }

        .assigned-item-tag button {
            background: transparent;
            border: none;
            color: var(--white);
            padding: 0;
            margin: 0;
            font-size: 1rem;
            cursor: pointer;
            line-height: 1;
            opacity: 0.8;
            transition: opacity 0.2s;
        }

        .assigned-item-tag button:hover {
            opacity: 1;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease;
        }

        .modal.active {
            display: flex;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: var(--white);
            border-radius: 4px;
            padding: 40px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease;
            border-top: 4px solid var(--accent);
        }

        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            font-family: 'Playfair Display', serif;
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 20px;
            font-weight: 700;
        }

        .modal-close {
            float: right;
            font-size: 2rem;
            font-weight: 300;
            color: var(--text-light);
            cursor: pointer;
            line-height: 1;
            transition: color 0.2s;
        }

        .modal-close:hover {
            color: var(--primary);
        }

        .event-select-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .event-select-item {
            padding: 16px;
            background: var(--cream);
            border: 2px solid var(--sand);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .event-select-item:hover {
            border-color: var(--accent);
            background: var(--white);
            transform: translateX(4px);
        }

        .event-select-item.selected {
            border-color: var(--accent);
            background: var(--accent);
            color: var(--white);
        }

        .event-select-name {
            font-weight: 700;
            margin-bottom: 4px;
        }

        .event-select-date {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-light);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 40px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--primary), #34495e);
            color: var(--white);
            padding: 30px;
            border-radius: 4px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .stat-number {
            font-family: 'Playfair Display', serif;
            font-size: 3rem;
            font-weight: 900;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            opacity: 0.9;
        }

        .weather-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 16px;
            margin-top: 20px;
        }

        .weather-card {
            background: linear-gradient(135deg, var(--cream), var(--sand));
            padding: 20px;
            border-radius: 4px;
            text-align: center;
            border: 2px solid var(--sand);
            transition: all 0.3s ease;
        }

        .weather-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
            border-color: var(--accent);
        }

        .weather-date {
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .weather-icon {
            font-size: 2.5rem;
            margin: 10px 0;
        }

        .weather-temp {
            font-family: 'Playfair Display', serif;
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
            margin: 8px 0;
        }

        .weather-desc {
            font-size: 0.85rem;
            color: var(--text-light);
            text-transform: capitalize;
        }

        .weather-recommendation {
            background: var(--accent);
            color: var(--white);
            padding: 20px;
            border-radius: 4px;
            margin-top: 20px;
            border-left: 4px solid var(--accent-dark);
        }

        .weather-recommendation h3 {
            font-family: 'Playfair Display', serif;
            font-size: 1.3rem;
            margin-bottom: 10px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text-light);
        }

        .loading::after {
            content: '...';
            animation: dots 1.5s steps(4, end) infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        .save-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--accent);
            color: var(--white);
            padding: 16px 24px;
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            z-index: 2000;
            animation: slideInRight 0.3s ease;
            font-weight: 600;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .save-notification.fade-out {
            animation: fadeOut 0.3s ease forwards;
        }

        @keyframes fadeOut {
            to {
                opacity: 0;
                transform: translateX(400px);
            }
        }

        @media (max-width: 968px) {
            .grid {
                grid-template-columns: 1fr;
            }

            h1 {
                font-size: 2.5rem;
            }

            .stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>Pack To The Future</h1>
        <p class="tagline">Plan your outfits ahead of time</p>
        <div style="margin-top: 20px; display: flex; gap: 12px; justify-content: center; flex-wrap: wrap;">
            <button id="installAppBtn" onclick="triggerInstall()" class="btn-primary" style="padding: 10px 24px; display: none;"><span>üì± Install App</span></button>
            <button onclick="saveProgress()" class="btn-secondary" style="padding: 10px 24px;"><span>üíæ Save Progress</span></button>
            <button onclick="loadProgress()" class="btn-secondary" style="padding: 10px 24px;"><span>üìÇ Load Progress</span></button>
            <button onclick="clearAllData()" class="btn-secondary" style="padding: 10px 24px; opacity: 0.7;"><span>üóëÔ∏è Clear All</span></button>
        </div>
    </header>

    <div class="container">
        <div class="card" style="margin-bottom: 40px;">
            <h2>Trip Details</h2>
            <form id="tripForm" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                <div class="form-group">
                    <label for="destination">Destination</label>
                    <input type="text" id="destination" placeholder="e.g., Paris, France" required>
                </div>
                <div class="form-group">
                    <label for="startDate">Start Date</label>
                    <input type="date" id="startDate" required>
                </div>
                <div class="form-group">
                    <label for="endDate">End Date</label>
                    <input type="date" id="endDate" required>
                </div>
                <div class="form-group" style="display: flex; align-items: flex-end;">
                    <button type="submit" class="btn-primary" style="width: 100%;"><span>Get Weather Forecast</span></button>
                </div>
            </form>
            <div id="weatherDisplay" style="margin-top: 30px;"></div>
        </div>

        <div class="stats">
            <div class="stat-card">
                <div class="stat-number" id="eventCount">0</div>
                <div class="stat-label">Events</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="itemCount">0</div>
                <div class="stat-label">Items to Pack</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="packedCount">0</div>
                <div class="stat-label">Packed</div>
            </div>
        </div>

        <div class="grid">
            <div class="card">
                <h2>Add Event</h2>
                <form id="eventForm">
                    <div class="form-group">
                        <label for="eventDate">Date</label>
                        <input type="date" id="eventDate" required>
                    </div>
                    <div class="form-group">
                        <label for="eventName">Event Name</label>
                        <input type="text" id="eventName" placeholder="e.g., Beach Day, Dinner at Resort" required>
                    </div>
                    <div class="form-group">
                        <label for="eventOutfit">Outfit Details</label>
                        <textarea id="eventOutfit" placeholder="List items you'll wear for this event...&#10;e.g., Blue sundress, straw hat, sandals, sunglasses"></textarea>
                    </div>
                    <div class="button-group">
                        <button type="submit" class="btn-primary"><span>Add Event</span></button>
                        <button type="button" class="btn-secondary" onclick="clearForm()"><span>Clear</span></button>
                    </div>
                </form>
            </div>

            <div class="card">
                <h2>Your Itinerary</h2>
                <div class="event-list" id="eventList">
                    <div class="empty-state">
                        <div class="empty-state-icon">‚úàÔ∏è</div>
                        <p>No events planned yet.<br>Start building your vacation wardrobe!</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="packing-section">
            <h2>Packing Checklist</h2>
            <p style="color: var(--text-light); margin-bottom: 20px;">Click items as you pack them</p>
            
            <div class="card" style="margin-bottom: 30px; padding: 25px; background: var(--cream); border-top: 3px solid var(--accent);">
                <h3 style="font-family: 'Playfair Display', serif; font-size: 1.3rem; color: var(--primary); margin-bottom: 15px;">Add Items Manually</h3>
                <form id="manualItemForm" style="display: flex; gap: 12px; align-items: flex-end;">
                    <div class="form-group" style="flex: 2; margin-bottom: 0;">
                        <label for="manualItem">Item Name</label>
                        <input type="text" id="manualItem" placeholder="e.g., Blue sweater, Running shoes" required>
                    </div>
                    <div class="form-group" style="flex: 1; margin-bottom: 0;">
                        <label for="manualCategory">Category</label>
                        <select id="manualCategory">
                            <option value="auto">Auto-detect</option>
                            <option value="shirts">Shirts & Tops</option>
                            <option value="sweatshirts">Sweatshirts/Hoodies</option>
                            <option value="jackets">Jackets & Coats</option>
                            <option value="pants">Pants & Bottoms</option>
                            <option value="shoes">Footwear</option>
                            <option value="accessories">Accessories</option>
                            <option value="other">Other Items</option>
                        </select>
                    </div>
                    <button type="submit" class="btn-secondary" style="margin-bottom: 0;"><span>Add Item</span></button>
                </form>
            </div>
            
            <div class="category-filters" id="categoryFilters">
                <button class="filter-btn active" onclick="filterCategory('all')"><span>All Items</span></button>
                <button class="filter-btn" onclick="filterCategory('shirts')"><span>Shirts</span></button>
                <button class="filter-btn" onclick="filterCategory('sweatshirts')"><span>Sweatshirts/Hoodies</span></button>
                <button class="filter-btn" onclick="filterCategory('jackets')"><span>Jackets</span></button>
                <button class="filter-btn" onclick="filterCategory('pants')"><span>Pants</span></button>
                <button class="filter-btn" onclick="filterCategory('shoes')"><span>Shoes</span></button>
                <button class="filter-btn" onclick="filterCategory('accessories')"><span>Accessories</span></button>
                <button class="filter-btn" onclick="filterCategory('other')"><span>Other</span></button>
            </div>

            <div id="packingList">
                <div class="empty-state">
                    <div class="empty-state-icon">üß≥</div>
                    <p>Add events to generate your packing list</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Assignment Modal -->
    <div id="assignModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeAssignModal()">&times;</span>
            <h2 class="modal-header">Assign to Event</h2>
            <p style="color: var(--text-light); margin-bottom: 20px;">Select which event you'll wear this item for:</p>
            <div id="eventSelectList" class="event-select-list"></div>
        </div>
    </div>

    <script>
        let events = [];
        let packedItems = new Set();
        let activeFilter = 'all';
        let manualItems = []; // Items added manually
        let itemAssignments = {}; // Track which items are assigned to which events
        let currentAssigningItem = null; // Track item being assigned
        let tripDetails = {
            destination: '',
            startDate: '',
            endDate: '',
            weather: []
        };

        // Category detection keywords
        const categoryKeywords = {
            'shirts': ['shirt', 't-shirt', 'tshirt', 'tee', 'blouse', 'top', 'tank', 'cami', 'polo'],
            'sweatshirts': ['sweatshirt', 'hoodie', 'hoody', 'pullover', 'sweater', 'cardigan', 'jumper'],
            'jackets': ['jacket', 'coat', 'blazer', 'windbreaker', 'parka', 'bomber', 'denim jacket', 'jean jacket'],
            'pants': ['pants', 'jeans', 'trousers', 'slacks', 'leggings', 'shorts', 'skirt', 'dress'],
            'shoes': ['shoes', 'sneakers', 'boots', 'sandals', 'heels', 'flats', 'loafers', 'slippers', 'flip flops'],
            'accessories': ['hat', 'cap', 'scarf', 'belt', 'bag', 'purse', 'backpack', 'sunglasses', 'glasses', 'watch', 'jewelry', 'necklace', 'bracelet', 'earrings', 'ring', 'tie', 'bowtie', 'socks']
        };

        document.getElementById('tripForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            await fetchWeather();
        });

        document.getElementById('manualItemForm').addEventListener('submit', function(e) {
            e.preventDefault();
            addManualItem();
        });

        document.getElementById('eventForm').addEventListener('submit', function(e) {
            e.preventDefault();
            addEvent();
        });

        function addEvent() {
            const date = document.getElementById('eventDate').value;
            const name = document.getElementById('eventName').value;
            const outfit = document.getElementById('eventOutfit').value;

            const event = {
                id: Date.now(),
                date: date,
                name: name,
                outfit: outfit
            };

            events.push(event);
            events.sort((a, b) => new Date(a.date) - new Date(b.date));

            clearForm();
            renderEvents();
            generatePackingList();
            updateStats();
        }

        function clearForm() {
            document.getElementById('eventForm').reset();
        }

        function addManualItem() {
            const itemName = document.getElementById('manualItem').value.trim();
            const selectedCategory = document.getElementById('manualCategory').value;

            if (!itemName) return;

            const itemLower = itemName.toLowerCase();
            const category = selectedCategory === 'auto' ? categorizeItem(itemName) : selectedCategory;

            manualItems.push({
                id: Date.now(),
                name: itemLower,
                category: category,
                isManual: true
            });

            document.getElementById('manualItemForm').reset();
            generatePackingList();
            updateStats();
        }

        function deleteEvent(id) {
            events = events.filter(e => e.id !== id);
            // Clean up assignments for deleted event
            Object.keys(itemAssignments).forEach(item => {
                if (itemAssignments[item] === id) {
                    delete itemAssignments[item];
                }
            });
            renderEvents();
            generatePackingList();
            updateStats();
        }

        function renderEvents() {
            const eventList = document.getElementById('eventList');
            
            if (events.length === 0) {
                eventList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">‚úàÔ∏è</div>
                        <p>No events planned yet.<br>Start building your vacation wardrobe!</p>
                    </div>
                `;
                return;
            }

            eventList.innerHTML = events.map(event => {
                const assignedItems = Object.entries(itemAssignments)
                    .filter(([item, eventId]) => eventId === event.id)
                    .map(([item]) => item);

                return `
                    <div class="event-item">
                        <div class="event-header">
                            <div class="event-title">${event.name}</div>
                            <div class="event-date">${formatDate(event.date)}</div>
                        </div>
                        ${event.outfit ? `<div class="event-outfit">${event.outfit}</div>` : '<div class="event-outfit" style="color: var(--text-light); font-style: italic;">No outfit details specified</div>'}
                        ${assignedItems.length > 0 ? `
                            <div class="assigned-items">
                                <div class="assigned-items-header">Assigned Items:</div>
                                <div>
                                    ${assignedItems.map(item => `
                                        <span class="assigned-item-tag">
                                            ${item}
                                            <button onclick="unassignItem('${item.replace(/'/g, "\\'")}', ${event.id})" title="Remove assignment">√ó</button>
                                        </span>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}
                        <button class="delete-btn" onclick="deleteEvent(${event.id})"><span>Remove Event</span></button>
                    </div>
                `;
            }).join('');
        }

        function formatDate(dateString) {
            const date = new Date(dateString + 'T00:00:00');
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        }

        function categorizeItem(item) {
            const itemLower = item.toLowerCase();
            
            for (const [category, keywords] of Object.entries(categoryKeywords)) {
                if (keywords.some(keyword => itemLower.includes(keyword))) {
                    return category;
                }
            }
            
            return 'other';
        }

        function generatePackingList() {
            const itemsByCategory = {
                'shirts': new Map(),
                'sweatshirts': new Map(),
                'jackets': new Map(),
                'pants': new Map(),
                'shoes': new Map(),
                'accessories': new Map(),
                'other': new Map()
            };
            
            // Add items from events
            events.forEach(event => {
                if (!event.outfit || !event.outfit.trim()) return; // Skip events without outfit details
                const items = event.outfit.split(/[,\n]/).map(item => item.trim()).filter(item => item.length > 0);
                items.forEach(item => {
                    const itemLower = item.toLowerCase();
                    const category = categorizeItem(item);
                    if (!itemsByCategory[category].has(itemLower)) {
                        itemsByCategory[category].set(itemLower, { name: itemLower, isManual: false });
                    }
                });
            });

            // Add manual items
            manualItems.forEach(item => {
                if (!itemsByCategory[item.category].has(item.name)) {
                    itemsByCategory[item.category].set(item.name, { name: item.name, isManual: true, id: item.id });
                }
            });

            const packingList = document.getElementById('packingList');
            
            const totalItems = Array.from(Object.values(itemsByCategory)).reduce((sum, map) => sum + map.size, 0);
            
            if (totalItems === 0) {
                packingList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üß≥</div>
                        <p>Add events or items manually to generate your packing list</p>
                    </div>
                `;
                return;
            }

            let html = '';

            const categoryLabels = {
                'shirts': 'Shirts & Tops',
                'sweatshirts': 'Sweatshirts & Hoodies',
                'jackets': 'Jackets & Coats',
                'pants': 'Pants & Bottoms',
                'shoes': 'Footwear',
                'accessories': 'Accessories',
                'other': 'Other Items'
            };

            for (const [category, itemsMap] of Object.entries(itemsByCategory)) {
                if (itemsMap.size === 0) continue;
                if (activeFilter !== 'all' && activeFilter !== category) continue;

                const sortedItems = Array.from(itemsMap.values()).sort((a, b) => a.name.localeCompare(b.name));
                const packedInCategory = sortedItems.filter(item => packedItems.has(item.name)).length;

                html += `
                    <div class="category-section">
                        <div class="category-header">
                            <span>${categoryLabels[category]}</span>
                            <span class="category-count">${packedInCategory}/${itemsMap.size} packed</span>
                        </div>
                        <div class="packing-grid">
                            ${sortedItems.map(item => {
                                const assignedEvent = events.find(e => e.id === itemAssignments[item.name]);
                                const assignmentText = assignedEvent ? ` ‚Ä¢ ${assignedEvent.name}` : '';
                                
                                return `
                                    <div class="packing-item ${packedItems.has(item.name) ? 'packed' : ''}" onclick="togglePacked('${item.name.replace(/'/g, "\\'")}')">
                                        <div class="checkbox"></div>
                                        <div class="packing-item-name">${item.name}${assignmentText ? `<div style="font-size: 0.75rem; color: var(--text-light); font-weight: 400; margin-top: 2px;">${assignmentText}</div>` : ''}</div>
                                        <button class="assign-btn" onclick="event.stopPropagation(); openAssignModal('${item.name.replace(/'/g, "\\'")}')" title="Assign to event"><span>üìÖ</span></button>
                                        ${item.isManual ? `
                                            <button class="delete-btn" style="margin: 0; padding: 4px 8px; font-size: 0.75rem;" onclick="event.stopPropagation(); deleteManualItem(${item.id})"><span>√ó</span></button>
                                        ` : ''}
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                `;
            }

            packingList.innerHTML = html;
            updateStats();
        }

        function togglePacked(item) {
            if (packedItems.has(item)) {
                packedItems.delete(item);
            } else {
                packedItems.add(item);
            }
            generatePackingList();
        }

        function deleteManualItem(id) {
            manualItems = manualItems.filter(item => item.id !== id);
            generatePackingList();
            updateStats();
        }

        function filterCategory(category) {
            activeFilter = category;
            
            // Update button states
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.closest('.filter-btn').classList.add('active');
            
            generatePackingList();
        }

        function updateStats() {
            document.getElementById('eventCount').textContent = events.length;
            
            const allItems = new Set();
            
            // Add items from events
            events.forEach(event => {
                if (!event.outfit || !event.outfit.trim()) return; // Skip events without outfit details
                const items = event.outfit.split(/[,\n]/).map(item => item.trim()).filter(item => item.length > 0);
                items.forEach(item => allItems.add(item.toLowerCase()));
            });
            
            // Add manual items
            manualItems.forEach(item => {
                allItems.add(item.name);
            });
            
            document.getElementById('itemCount').textContent = allItems.size;
            document.getElementById('packedCount').textContent = packedItems.size;
        }

        function openAssignModal(itemName) {
            if (events.length === 0) {
                alert('Please add some events first before assigning items!');
                return;
            }

            currentAssigningItem = itemName;
            const modal = document.getElementById('assignModal');
            const eventSelectList = document.getElementById('eventSelectList');
            
            eventSelectList.innerHTML = events.map(event => {
                const isAssigned = itemAssignments[itemName] === event.id;
                return `
                    <div class="event-select-item ${isAssigned ? 'selected' : ''}" onclick="assignItemToEvent(${event.id})">
                        <div class="event-select-name">${event.name}</div>
                        <div class="event-select-date">${formatDate(event.date)}</div>
                    </div>
                `;
            }).join('');
            
            modal.classList.add('active');
        }

        function closeAssignModal() {
            const modal = document.getElementById('assignModal');
            modal.classList.remove('active');
            currentAssigningItem = null;
        }

        function assignItemToEvent(eventId) {
            if (currentAssigningItem) {
                // Toggle assignment
                if (itemAssignments[currentAssigningItem] === eventId) {
                    delete itemAssignments[currentAssigningItem];
                } else {
                    itemAssignments[currentAssigningItem] = eventId;
                }
                renderEvents();
                generatePackingList();
                closeAssignModal();
            }
        }

        function unassignItem(itemName, eventId) {
            if (itemAssignments[itemName] === eventId) {
                delete itemAssignments[itemName];
                renderEvents();
                generatePackingList();
            }
        }

        // Close modal when clicking outside
        document.getElementById('assignModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeAssignModal();
            }
        });

        async function fetchWeather() {
            const destination = document.getElementById('destination').value;
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;

            if (!destination || !startDate || !endDate) {
                alert('Please fill in all trip details');
                return;
            }

            const start = new Date(startDate);
            const end = new Date(endDate);

            if (end < start) {
                alert('End date must be after start date');
                return;
            }

            tripDetails.destination = destination;
            tripDetails.startDate = startDate;
            tripDetails.endDate = endDate;

            const weatherDisplay = document.getElementById('weatherDisplay');
            weatherDisplay.innerHTML = '<div class="loading">Fetching weather forecast</div>';

            try {
                // Get coordinates for the destination
                const geoUrl = `https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(destination)}&count=1`;
                const geoResponse = await fetch(geoUrl);
                
                if (!geoResponse.ok) {
                    throw new Error(`Failed to fetch location data (Status: ${geoResponse.status})`);
                }
                
                const geoData = await geoResponse.json();

                if (!geoData.results || geoData.results.length === 0) {
                    throw new Error('Location not found. Please try a different city name or add country (e.g., "Paris, France")');
                }

                const { latitude, longitude, name, country } = geoData.results[0];

                // Get weather forecast
                const weatherUrl = `https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&daily=temperature_2m_max,temperature_2m_min,weathercode,precipitation_probability_max&timezone=auto&temperature_unit=fahrenheit&start_date=${startDate}&end_date=${endDate}`;
                const weatherResponse = await fetch(weatherUrl);
                
                if (!weatherResponse.ok) {
                    throw new Error(`Failed to fetch weather data (Status: ${weatherResponse.status})`);
                }
                
                const weatherData = await weatherResponse.json();

                if (!weatherData.daily || !weatherData.daily.time) {
                    throw new Error('Invalid weather data received');
                }

                tripDetails.weather = weatherData.daily.time.map((date, index) => ({
                    date: date,
                    temp_max: Math.round(weatherData.daily.temperature_2m_max[index]),
                    temp_min: Math.round(weatherData.daily.temperature_2m_min[index]),
                    weathercode: weatherData.daily.weathercode[index],
                    precipitation: weatherData.daily.precipitation_probability_max[index]
                }));

                displayWeather(name, country);
            } catch (error) {
                let errorMessage = 'Unable to fetch weather data.';
                
                if (error.message.includes('NetworkError') || error.message.includes('Failed to fetch')) {
                    errorMessage = 'Network error: Unable to connect to weather service. Please check your internet connection.';
                } else if (error.message) {
                    errorMessage = error.message;
                }
                
                weatherDisplay.innerHTML = `
                    <div style="background: #ffebee; border-left: 4px solid #e74c3c; padding: 20px; border-radius: 4px;">
                        <strong style="color: #c62828;">Weather Fetch Error</strong>
                        <p style="color: var(--text); margin-top: 8px;">${errorMessage}</p>
                        <p style="color: var(--text-light); font-size: 0.9rem; margin-top: 8px;">
                            <strong>Troubleshooting:</strong><br>
                            ‚Ä¢ Try a specific city name (e.g., "Tokyo" or "New York, USA")<br>
                            ‚Ä¢ Check your internet connection<br>
                            ‚Ä¢ Make sure the dates are in the future (within 16 days)
                        </p>
                    </div>
                `;
                console.error('Weather fetch error:', error);
            }
        }

        function getWeatherIcon(code) {
            const weatherIcons = {
                0: '‚òÄÔ∏è', // Clear sky
                1: 'üå§Ô∏è', // Mainly clear
                2: '‚õÖ', // Partly cloudy
                3: '‚òÅÔ∏è', // Overcast
                45: 'üå´Ô∏è', // Foggy
                48: 'üå´Ô∏è', // Foggy
                51: 'üå¶Ô∏è', // Light drizzle
                53: 'üå¶Ô∏è', // Drizzle
                55: 'üåßÔ∏è', // Heavy drizzle
                61: 'üåßÔ∏è', // Light rain
                63: 'üåßÔ∏è', // Rain
                65: 'üåßÔ∏è', // Heavy rain
                71: 'üå®Ô∏è', // Light snow
                73: '‚ùÑÔ∏è', // Snow
                75: '‚ùÑÔ∏è', // Heavy snow
                77: '‚ùÑÔ∏è', // Snow grains
                80: 'üå¶Ô∏è', // Light showers
                81: 'üåßÔ∏è', // Showers
                82: '‚õàÔ∏è', // Heavy showers
                85: 'üå®Ô∏è', // Light snow showers
                86: '‚ùÑÔ∏è', // Snow showers
                95: '‚õàÔ∏è', // Thunderstorm
                96: '‚õàÔ∏è', // Thunderstorm with hail
                99: '‚õàÔ∏è' // Thunderstorm with hail
            };
            return weatherIcons[code] || 'üå§Ô∏è';
        }

        function getWeatherDescription(code) {
            const descriptions = {
                0: 'Clear', 1: 'Mostly Clear', 2: 'Partly Cloudy', 3: 'Cloudy',
                45: 'Foggy', 48: 'Foggy', 51: 'Light Drizzle', 53: 'Drizzle', 55: 'Heavy Drizzle',
                61: 'Light Rain', 63: 'Rain', 65: 'Heavy Rain',
                71: 'Light Snow', 73: 'Snow', 75: 'Heavy Snow', 77: 'Snow',
                80: 'Light Showers', 81: 'Showers', 82: 'Heavy Showers',
                85: 'Light Snow', 86: 'Snow Showers',
                95: 'Thunderstorm', 96: 'Thunderstorm', 99: 'Thunderstorm'
            };
            return descriptions[code] || 'Partly Cloudy';
        }

        function displayWeather(locationName, country) {
            const weatherDisplay = document.getElementById('weatherDisplay');
            
            const avgTemp = tripDetails.weather.reduce((sum, day) => sum + day.temp_max, 0) / tripDetails.weather.length;
            const hasRain = tripDetails.weather.some(day => day.precipitation > 50);
            const hasCold = tripDetails.weather.some(day => day.temp_max < 59); // 59¬∞F = 15¬∞C
            const hasHot = tripDetails.weather.some(day => day.temp_max > 77); // 77¬∞F = 25¬∞C

            let recommendations = [];
            if (hasRain) recommendations.push('Rain jacket or umbrella');
            if (hasCold) recommendations.push('Warm layers and jacket');
            if (hasHot) recommendations.push('Light, breathable clothing');
            if (avgTemp > 68) recommendations.push('Sunscreen and sunglasses'); // 68¬∞F = 20¬∞C
            
            const weatherCards = tripDetails.weather.map(day => {
                const date = new Date(day.date + 'T00:00:00');
                const dateStr = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                
                return `
                    <div class="weather-card">
                        <div class="weather-date">${dateStr}</div>
                        <div class="weather-icon">${getWeatherIcon(day.weathercode)}</div>
                        <div class="weather-temp">${day.temp_max}¬∞F</div>
                        <div class="weather-desc">${getWeatherDescription(day.weathercode)}</div>
                    </div>
                `;
            }).join('');

            weatherDisplay.innerHTML = `
                <div style="margin-bottom: 20px;">
                    <h3 style="font-family: 'Playfair Display', serif; font-size: 1.5rem; color: var(--primary); margin-bottom: 10px;">
                        ${locationName}, ${country}
                    </h3>
                    <p style="color: var(--text-light);">
                        ${formatDate(tripDetails.startDate)} - ${formatDate(tripDetails.endDate)}
                    </p>
                </div>
                <div class="weather-grid">
                    ${weatherCards}
                </div>
                ${recommendations.length > 0 ? `
                    <div class="weather-recommendation">
                        <h3>Packing Recommendations</h3>
                        <p>${recommendations.join(' ‚Ä¢ ')}</p>
                    </div>
                ` : ''}
            `;
        }

        // Initialize
        updateStats();
        loadProgressFromStorage(); // Auto-load on page load

        // Auto-save functionality
        function autoSave() {
            const data = {
                events: events,
                manualItems: manualItems,
                itemAssignments: itemAssignments,
                packedItems: Array.from(packedItems),
                tripDetails: tripDetails,
                timestamp: new Date().toISOString()
            };
            localStorage.setItem('packToTheFuture_data', JSON.stringify(data));
        }

        function saveProgress() {
            autoSave();
            showNotification('‚úì Progress saved successfully!');
        }

        function loadProgress() {
            if (confirm('Load saved progress? This will replace your current data.')) {
                loadProgressFromStorage();
                showNotification('‚úì Progress loaded successfully!');
            }
        }

        function loadProgressFromStorage() {
            try {
                const savedData = localStorage.getItem('packToTheFuture_data');
                if (savedData) {
                    const data = JSON.parse(savedData);
                    events = data.events || [];
                    manualItems = data.manualItems || [];
                    itemAssignments = data.itemAssignments || {};
                    packedItems = new Set(data.packedItems || []);
                    tripDetails = data.tripDetails || { destination: '', startDate: '', endDate: '', weather: [] };
                    
                    // Restore form values if trip details exist
                    if (tripDetails.destination) {
                        document.getElementById('destination').value = tripDetails.destination;
                        document.getElementById('startDate').value = tripDetails.startDate;
                        document.getElementById('endDate').value = tripDetails.endDate;
                        
                        // Restore weather display if it exists
                        if (tripDetails.weather && tripDetails.weather.length > 0) {
                            displayWeather(tripDetails.destination.split(',')[0], tripDetails.destination);
                        }
                    }
                    
                    renderEvents();
                    generatePackingList();
                    updateStats();
                }
            } catch (error) {
                console.error('Error loading saved data:', error);
            }
        }

        function clearAllData() {
            if (confirm('‚ö†Ô∏è Are you sure you want to clear all data? This cannot be undone!')) {
                localStorage.removeItem('packToTheFuture_data');
                events = [];
                manualItems = [];
                itemAssignments = {};
                packedItems = new Set();
                tripDetails = { destination: '', startDate: '', endDate: '', weather: [] };
                
                document.getElementById('tripForm').reset();
                document.getElementById('weatherDisplay').innerHTML = '';
                
                renderEvents();
                generatePackingList();
                updateStats();
                
                showNotification('‚úì All data cleared');
            }
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'save-notification';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('fade-out');
                setTimeout(() => notification.remove(), 300);
            }, 2000);
        }

        // Auto-save whenever data changes
        const originalAddEvent = addEvent;
        addEvent = function() {
            originalAddEvent();
            autoSave();
        };

        const originalDeleteEvent = deleteEvent;
        deleteEvent = function(id) {
            originalDeleteEvent(id);
            autoSave();
        };

        const originalAddManualItem = addManualItem;
        addManualItem = function() {
            originalAddManualItem();
            autoSave();
        };

        const originalDeleteManualItem = deleteManualItem;
        deleteManualItem = function(id) {
            originalDeleteManualItem(id);
            autoSave();
        };

        const originalTogglePacked = togglePacked;
        togglePacked = function(item) {
            originalTogglePacked(item);
            autoSave();
        };

        const originalAssignItemToEvent = assignItemToEvent;
        assignItemToEvent = function(eventId) {
            originalAssignItemToEvent(eventId);
            autoSave();
        };

        const originalUnassignItem = unassignItem;
        unassignItem = function(itemName, eventId) {
            originalUnassignItem(itemName, eventId);
            autoSave();
        };

        // PWA: Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then(registration => {
                        console.log('Service Worker registered successfully:', registration.scope);
                    })
                    .catch(error => {
                        console.log('Service Worker registration failed:', error);
                    });
            });
        }

        // PWA: Install Prompt
        let deferredPrompt;
        const installBtn = document.getElementById('installAppBtn');

        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('beforeinstallprompt event fired');
            e.preventDefault();
            deferredPrompt = e;
            
            // Show the install button
            if (installBtn) {
                installBtn.style.display = 'inline-block';
            }
            
            // Show install banner after a short delay
            setTimeout(() => {
                showInstallPrompt();
            }, 5000); // Increased to 5 seconds
        });

        function triggerInstall() {
            if (!deferredPrompt) {
                // Show manual instructions if prompt not available
                showManualInstallInstructions();
                return;
            }
            
            deferredPrompt.prompt();
            deferredPrompt.userChoice.then((choiceResult) => {
                if (choiceResult.outcome === 'accepted') {
                    console.log('User accepted the install prompt');
                    showNotification('‚úì App installing...');
                } else {
                    console.log('User dismissed the install prompt');
                }
                deferredPrompt = null;
                if (installBtn) {
                    installBtn.style.display = 'none';
                }
            });
        }

        function showManualInstallInstructions() {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 500px;">
                    <span class="modal-close" onclick="this.parentElement.parentElement.remove()">&times;</span>
                    <h2 class="modal-header">Install Pack To The Future</h2>
                    
                    <div style="text-align: left; line-height: 1.8;">
                        <p style="margin-bottom: 20px; color: var(--text-light);">
                            Follow these steps to install the app on your device:
                        </p>
                        
                        <div style="background: var(--cream); padding: 20px; border-radius: 4px; margin-bottom: 20px;">
                            <strong style="color: var(--primary); display: block; margin-bottom: 12px;">üì± On iPhone/iPad:</strong>
                            <ol style="margin-left: 20px; color: var(--text);">
                                <li>Tap the Share button <span style="font-size: 1.2rem;">‚éã</span></li>
                                <li>Scroll down and tap "Add to Home Screen"</li>
                                <li>Tap "Add" in the top right</li>
                            </ol>
                        </div>
                        
                        <div style="background: var(--cream); padding: 20px; border-radius: 4px; margin-bottom: 20px;">
                            <strong style="color: var(--primary); display: block; margin-bottom: 12px;">üì± On Android:</strong>
                            <ol style="margin-left: 20px; color: var(--text);">
                                <li>Tap the menu (‚ãÆ) in the browser</li>
                                <li>Tap "Add to Home screen" or "Install app"</li>
                                <li>Tap "Install" or "Add"</li>
                            </ol>
                        </div>
                        
                        <div style="background: var(--cream); padding: 20px; border-radius: 4px;">
                            <strong style="color: var(--primary); display: block; margin-bottom: 12px;">üíª On Desktop:</strong>
                            <ol style="margin-left: 20px; color: var(--text);">
                                <li>Look for the install icon in the address bar</li>
                                <li>Click it and select "Install"</li>
                            </ol>
                        </div>
                        
                        <p style="margin-top: 20px; font-size: 0.9rem; color: var(--text-light);">
                            <strong>Note:</strong> Make sure you're accessing the app via HTTPS (secure connection) for install to work.
                        </p>
                    </div>
                    
                    <button onclick="this.parentElement.parentElement.remove()" class="btn-primary" style="width: 100%; margin-top: 20px;">
                        <span>Got It!</span>
                    </button>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function showInstallPrompt() {
            if (!deferredPrompt) return;
            
            const installBanner = document.createElement('div');
            installBanner.style.cssText = `
                position: fixed;
                bottom: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: linear-gradient(135deg, var(--primary), #34495e);
                color: white;
                padding: 20px 30px;
                border-radius: 8px;
                box-shadow: 0 8px 24px rgba(0,0,0,0.3);
                z-index: 3000;
                max-width: 90%;
                width: 400px;
                animation: slideUp 0.4s ease;
                display: flex;
                flex-direction: column;
                gap: 12px;
            `;
            
            installBanner.innerHTML = `
                <div style="display: flex; align-items: center; gap: 12px;">
                    <span style="font-size: 2rem;">üì±</span>
                    <div>
                        <strong style="display: block; font-size: 1.1rem; margin-bottom: 4px;">Install Pack To The Future</strong>
                        <span style="font-size: 0.9rem; opacity: 0.9;">Access your wardrobe planner anytime, even offline!</span>
                    </div>
                </div>
                <div style="display: flex; gap: 12px;">
                    <button id="installBannerBtn" style="flex: 1; padding: 12px; background: var(--accent); color: white; border: none; border-radius: 4px; font-weight: 700; cursor: pointer; text-transform: uppercase; letter-spacing: 1px;">Install</button>
                    <button id="dismissBannerBtn" style="flex: 1; padding: 12px; background: rgba(255,255,255,0.2); color: white; border: none; border-radius: 4px; font-weight: 700; cursor: pointer; text-transform: uppercase; letter-spacing: 1px;">Not Now</button>
                </div>
            `;
            
            document.body.appendChild(installBanner);
            
            document.getElementById('installBannerBtn').addEventListener('click', () => {
                triggerInstall();
                installBanner.remove();
            });
            
            document.getElementById('dismissBannerBtn').addEventListener('click', () => {
                installBanner.remove();
            });
        }

        // Track when app is installed
        window.addEventListener('appinstalled', () => {
            console.log('Pack To The Future has been installed!');
            showNotification('‚úì App installed successfully!');
            deferredPrompt = null;
            if (installBtn) {
                installBtn.style.display = 'none';
            }
        });

        // Check if already installed
        if (window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone === true) {
            console.log('App is running in standalone mode (already installed)');
            if (installBtn) {
                installBtn.style.display = 'none';
            }
        }
    </script>
</body>
</html>
